<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è¼ªèƒè‹±é›„ - æ¨‚å¯Œè‡ªè¡Œè»Š</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; touch-action: none; user-select: none; }
        canvas { display: block; }
        #ui { position: absolute; top: 15px; left: 15px; color: #000; font-weight: 900; font-size: 20px; text-shadow: 1px 1px 0 #fff; z-index: 100; pointer-events: none; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 200; }
        #msg-box { background: #fff; padding: 30px 20px; border: 4px solid #000; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; }
        .btn { display: inline-block; padding: 15px 40px; background: #00C853; color: #fff; border-radius: 50px; font-weight: bold; font-size: 24px; cursor: pointer; border: none; box-shadow: 0 6px 0 #1B5E20; }
    </style>
</head>
<body>

<div id="ui">
    <div>åˆ†æ•¸: <span id="score">0</span></div>
    <div style="font-size: 14px;">æœ€é«˜: <span id="highScore">0</span></div>
</div>

<div id="overlay">
    <div id="msg-box">
        <h2 id="msg-title">è¼ªèƒè‹±é›„</h2>
        <p style="font-weight: bold;">[ è¶…æ…¢é€Ÿç·´ç¿’ç‰ˆ ]</p>
        <p>è«‹ç¢ºèªæ‰‹æ©Ÿ**ééœéŸ³æ¨¡å¼**</p>
        <button class="btn" id="startBtn">é–‹å§‹æŒ‘æˆ°</button>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<audio id="sndJump" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
<audio id="sndCoin" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
<audio id="sndOver" src="https://assets.mixkit.co/active_storage/sfx/2530/2530-preview.mp3" preload="auto"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const highScoreEl = document.getElementById('highScore');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');

// éŸ³æ•ˆå…ƒç´ 
const sndJump = document.getElementById('sndJump');
const sndCoin = document.getElementById('sndCoin');
const sndOver = document.getElementById('sndOver');

let gameState = 'START'; 
let score = 0;
let highScore = localStorage.getItem('bicycleHighScore') || 0;
highScoreEl.innerText = highScore;

// é€Ÿåº¦æ›´æ…¢ (å¾ 2.5 é™åˆ° 1.8)
const WORLD_SPEED = 1.8; 
let player = { x: 50, y: 0, vy: 0, jumped: false };
let obstacles = [];
let coins = [];
let bgX = 0;
let distanceCounter = 0;

function playSound(audio) {
    audio.currentTime = 0;
    audio.play().catch(e => console.log("éŸ³æ•ˆé­æ””æˆª"));
}

startBtn.onclick = function() {
    // é»æ“Šç¬é–“å•Ÿå‹•æ‰€æœ‰éŸ³æ•ˆï¼ˆéœéŸ³æ’­æ”¾ä¸€æ¬¡ä»¥è§£é–ï¼‰
    [sndJump, sndCoin, sndOver].forEach(s => { s.play(); s.pause(); });
    startGame();
};

function startGame() {
    score = 0; scoreEl.innerText = '0';
    obstacles = []; coins = [];
    distanceCounter = 0;
    gameState = 'PLAYING';
    overlay.style.display = 'none';
}

// è·³èºæ“ä½œ
window.onpointerdown = function(e) {
    if (gameState === 'PLAYING' && !player.jumped) {
        player.vy = -12; // æ…¢é€Ÿç‰ˆè·³èºåŠ›ä¹Ÿèª¿å°ï¼Œæ¯”è¼ƒå¥½æ§åˆ¶
        player.jumped = true;
        playSound(sndJump);
    }
};

function drawCar(x, y, size) {
    ctx.save();
    ctx.translate(x, y);
    ctx.fillStyle = '#ff0000';
    ctx.fillRect(0, size*0.4, size, size*0.4); 
    ctx.fillStyle = '#333';
    ctx.beginPath(); ctx.arc(size*0.25, size*0.8, size*0.15, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(size*0.75, size*0.8, size*0.15, 0, Math.PI*2); ctx.fill();
    ctx.restore();
}

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    player.y = canvas.height * 0.7 - 50;
}
window.onresize = resize;
resize();

function update() {
    if (gameState !== 'PLAYING') return;
    
    bgX -= WORLD_SPEED;
    distanceCounter += WORLD_SPEED;
    if (bgX <= -canvas.width) bgX = 0;

    player.vy += 0.6; // é‡åŠ›ä¹Ÿèª¿æ…¢
    player.y += player.vy;
    let groundY = canvas.height * 0.7 - 50;
    if (player.y > groundY) { player.y = groundY; player.vy = 0; player.jumped = false; }

    // æ€ªç‰©é–“éš”æ‹‰é•· (å¾ 280 è®Š 350)
    if (distanceCounter > 350) { 
        const isCar = Math.random() > 0.3;
        if(isCar) obstacles.push({ x: canvas.width + 50, y: canvas.height * 0.7 - 60, type: 'car', speed: WORLD_SPEED + 1 });
        else obstacles.push({ x: canvas.width + 50, y: canvas.height * 0.7 - 40, type: 'banana', speed: WORLD_SPEED });
        distanceCounter = 0;
    }

    if (Math.random() < 0.015) coins.push({ x: canvas.width + 20, y: canvas.height * 0.7 - 120 - Math.random()*80 });

    obstacles.forEach((o, i) => {
        o.x -= o.speed;
        if (Math.abs(player.x - o.x) < 30 && Math.abs(player.y - o.y) < 35) {
            gameState = 'OVER';
            overlay.style.display = 'flex';
            document.getElementById('msg-title').innerText = "æ’åˆ°äº†ï¼";
            playSound(sndOver);
            if(score > highScore) {
                highScore = score;
                localStorage.setItem('bicycleHighScore', highScore);
                highScoreEl.innerText = highScore;
            }
        }
    });

    coins.forEach((c, i) => {
        c.x -= WORLD_SPEED;
        if (Math.abs(player.x - c.x) < 30 && Math.abs(player.y - c.y) < 35) {
            score += 10; scoreEl.innerText = score;
            playSound(sndCoin);
            coins.splice(i, 1);
        }
    });

    obstacles = obstacles.filter(o => o.x > -150);
    coins = coins.filter(c => c.x > -100);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#87CEEB'; ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#2E7D32';
    for(let i=0; i<3; i++) {
        let x = (bgX % canvas.width) + i * canvas.width;
        ctx.beginPath(); ctx.moveTo(x - canvas.width, canvas.height*0.7);
        ctx.lineTo(x - canvas.width/2, canvas.height*0.4);
        ctx.lineTo(x, canvas.height*0.7); ctx.fill();
    }

    ctx.fillStyle = '#444'; ctx.fillRect(0, canvas.height*0.7, canvas.width, canvas.height*0.3);
    
    ctx.save();
    ctx.translate(player.x + 25, player.y + 25);
    ctx.scale(-1, 1); 
    ctx.font = '50px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('ğŸš´', 0, 0);
    ctx.restore();

    obstacles.forEach(o => {
        if(o.type === 'car') drawCar(o.x, o.y, 70);
        else { ctx.font = '40px Arial'; ctx.fillText('ğŸŒ', o.x, o.y + 35); }
    });
    ctx.font = '35px Arial';
    coins.forEach(c => ctx.fillText('ğŸª™', c.x, c.y + 25));

    update();
    requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>