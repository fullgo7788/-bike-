<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>樂富衝鋒 - 專業版</title>
    <style>
        body { margin: 0; background: #000; color: #fff; overflow: hidden; font-family: monospace; touch-action: none; -webkit-tap-highlight-color: transparent; }
        canvas { display: block; }

        /* --- 頂部數據列 --- */
        #top-ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 100; font-weight: bold; }
        .stat-item { font-size: 18px; color: #ccff00; }
        .hp-bar-bg { width: 100px; height: 15px; background: rgba(255,255,255,0.2); display: inline-block; vertical-align: middle; border: 1px solid #fff; }
        #hp-fill { height: 100%; background: #fff; width: 100%; transition: 0.3s; }

        /* --- 任務簡報框 (左側) --- */
        #mission-box {
            position: absolute; top: 60px; left: 20px; width: 280px;
            border: 2px solid #ccff00; background: rgba(0,0,0,0.8);
            padding: 15px; z-index: 200; box-shadow: 0 0 15px rgba(204,255,0,0.3);
        }
        #mission-box h2 { color: #ccff00; margin: 0 0 10px 0; font-size: 24px; border-bottom: 1px solid #ccff00; }
        #mission-box p { font-size: 14px; line-height: 1.4; color: #eee; }
        #start-btn { 
            background: #ccff00; color: #000; border: none; width: 100%; 
            padding: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 18px;
        }

        /* --- 中央準星 --- */
        #crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; pointer-events: none; z-index: 50;
        }
        #crosshair::before, #crosshair::after { content: ''; position: absolute; background: #ccff00; }
        #crosshair::before { width: 100%; height: 2px; top: 50%; } /* 橫線 */
        #crosshair::after { height: 100%; width: 2px; left: 50%; }  /* 直線 */

        /* --- 單車龍頭 HUD --- */
        #bike-hud {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px; pointer-events: none; z-index: 10;
        }
        /* 您可以將此 SVG 替換成真正的單車 PNG 圖片網址 */
        .handlebar-img { width: 100%; filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); transition: transform 0.1s; }

        /* --- 右下角 CS 控制鈕 --- */
        #controls { position: absolute; bottom: 30px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 100; }
        .cs-btn {
            width: 80px; height: 80px; border-radius: 50%; border: 4px solid #fff;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 18px; color: #fff; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); pointer-events: all;
        }
        #fire-btn { background: linear-gradient(#ff4b2b, #ff416c); } /* 開火-紅 */
        #reload-btn { background: linear-gradient(#2193b0, #6dd5ed); } /* 換彈-藍 */
        .cs-btn:active { transform: scale(0.9); }

        /* 左下角虛擬搖桿預留區 */
        #joystick { position: absolute; bottom: 30px; left: 30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }

    </style>
</head>
<body>

    <div id="top-ui">
        <div>HP: <span id="hp-num">100</span>% <div class="hp-bar-bg"><div id="hp-fill"></div></div></div>
        <div class="stat-item">任務: <span id="score">0</span></div>
        <div class="stat-item">彈藥: <span id="ammo">10 / 10</span></div>
    </div>

    <div id="mission-box">
        <h2>1 索都強鋒</h2>
        <p>請人都在火在待一陣，看就是間的杞有彈，在出空，娘。22 wx 600 奪愛定問彌靈在眼力宵連的能輝。</p>
        <button id="start-btn">BUTON (開始)</button>
    </div>

    <div id="crosshair"></div>

    <div id="bike-hud">
        <svg class="handlebar-img" id="handle-svg" viewBox="0 0 600 300">
            <path d="M100,250 Q150,100 300,100 Q450,100 500,250" fill="none" stroke="#666" stroke-width="20"/>
            <rect x="250" y="80" width="100" height="40" rx="5" fill="#333" />
            <path d="M50,220 L150,120 M450,120 L550,220" stroke="#444" stroke-width="15" />
        </svg>
    </div>

    <div id="joystick"></div>

    <div id="controls">
        <div id="fire-btn" class="cs-btn">開火</div>
        <div id="reload-btn" class="cs-btn">換彈</div>
    </div>

    <canvas id="c"></canvas>

<script>
    const cvs=document.getElementById('c'), ctx=cvs.getContext('2d'),
          hpF=document.getElementById('hp-fill'), hpN=document.getElementById('hp-num'),
          scE=document.getElementById('score'), amE=document.getElementById('ammo'),
          mBox=document.getElementById('mission-box'), sBtn=document.getElementById('start-btn'),
          fBtn=document.getElementById('fire-btn'), rBtn=document.getElementById('reload-btn'),
          hSvg=document.getElementById('handle-svg');

    let score=0, hp=100, ammo=10, running=false, enemies=[], tilt=0, aCtx=null;

    function resize(){ cvs.width=window.innerWidth; cvs.height=window.innerHeight; }
    window.onresize=resize; resize();

    // --- 遊戲邏輯 ---
    sBtn.onclick = async () => {
        aCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            const res = await DeviceOrientationEvent.requestPermission();
            if (res === 'granted') {
                window.addEventListener('deviceorientation', e => { tilt = e.gamma; });
                mBox.style.display = 'none';
                start();
            }
        } else {
            window.addEventListener('deviceorientation', e => { tilt = e.gamma; });
            mBox.style.display = 'none';
            start();
        }
    };

    function start(){ running=true; gameLoop(); spawnEnemy(); }

    fBtn.onclick = () => {
        if(ammo > 0 && running) {
            ammo--; amE.innerText = `${ammo} / 10`;
            // 射擊效果...
        }
    };

    rBtn.onclick = () => {
        if(ammo < 10) {
            setTimeout(() => { ammo=10; amE.innerText = `10 / 10`; }, 1000);
        }
    };

    function spawnEnemy(){
        if(!running) return;
        enemies.push({x: Math.random()*cvs.width, y: -50, s: 2 + Math.random()*3});
        setTimeout(spawnEnemy, 1500);
    }

    function gameLoop(){
        if(!running) return;
        ctx.fillStyle = '#050510';
        ctx.fillRect(0,0,cvs.width,cvs.height);

        // 龍頭跟隨體感晃動
        hSvg.style.transform = `rotate(${tilt * 0.8}deg)`;

        // 繪製敵人 (簡單模擬)
        for(let i=enemies.length-1; i>=0; i--){
            let e = enemies[i]; e.y += e.s;
            ctx.fillStyle = '#ff4444';
            ctx.fillRect(e.x, e.y, 30, 30);
            
            if(e.y > cvs.height) {
                enemies.splice(i,1);
                hp -= 10;
                hpF.style.width = hp + '%';
                hpN.innerText = hp;
                if(hp <= 0) location.reload();
            }
        }
        requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>